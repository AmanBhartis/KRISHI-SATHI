<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Weather Forecast & Crop Advice | KRISHI SATHI</title>
    <meta name="description" content="7-day weather forecast, crop suggestions, and irrigation advice for your location.">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
      <div class="container-fluid">
        <a class="navbar-brand" href="index.html">KRISHI SATHI</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavDropdown">
          <ul class="navbar-nav ms-auto gap-3">
            <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
            <li class="nav-item"><a class="nav-link active" href="WEATHER.HTML">Weather</a></li>
            <li class="nav-item"><a class="nav-link" href="market.html">Market</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <header class="container mt-4">
      <h1>üå¶Ô∏è 7-Day Weather Forecast & Crop Advice</h1>
      <p>Get the latest weather forecast for your location, crop suggestions, and irrigation advice.</p>
    </header>

    <div class="container mb-4">
      <div class="row">
        <div class="col-md-7">
          <h2>üìÖ 7-Day Weather Forecast</h2>
          <div id="weather-forecast" class="mb-3"></div>
        </div>
        <div class="col-md-5">
          <h2>üå± Crop Suggestions</h2>
          <div id="crop-suggestion"></div>
          <h2 class="mt-4">üíß Irrigation Advice</h2>
          <div id="irrigation-advice"></div>
        </div>
      </div>
    </div>

    <div class="container mb-4">
      <h2>üß™ Fertilizer Advice & Resources</h2>
      <div id="fertilizer-advice" class="mb-3 alert alert-info"></div>
      <div>
        <h5>üé• Fertilizer Use & Best Practices (YouTube)</h5>
        <div class="row">
          <div class="col-md-6 mb-2">
            <iframe width="100%" height="215" src="https://www.youtube.com/embed/8Kf6Qd2w4gE" title="Fertilizer Application Tips for Farmers" frameborder="0" allowfullscreen></iframe>
          </div>
          <div class="col-md-6 mb-2">
            <iframe width="100%" height="215" src="https://www.youtube.com/embed/6nQZy4QyQnA" title="How to Use Fertilizer for Maximum Yield" frameborder="0" allowfullscreen></iframe>
          </div>
        </div>
      </div>
    </div>

    <footer class="bg-light text-center py-3 mt-4">
      <div class="col-md-4 mx-auto">
        <h4>üìç Our Address</h4>
        <address>
          Krishi Sathi Center<br>
          123 Greenfield Road,<br>
          Patna, Bihar, 800001<br>
          Phone: +91 98765 43210<br>
          Email: info@krishisathi.com
        </address>
        <small>¬© 2025 Krishi Sathi. All rights reserved.</small>
      </div>
    </footer>

    <script>
      // Weather code to description mapping
      function weatherDescription(code) {
        const map = {
          0: "Clear sky",
          1: "Mainly clear",
          2: "Partly cloudy",
          3: "Overcast",
          45: "Fog",
          48: "Depositing rime fog",
          51: "Light drizzle",
          53: "Moderate drizzle",
          55: "Dense drizzle",
          56: "Light freezing drizzle",
          57: "Dense freezing drizzle",
          61: "Slight rain",
          63: "Moderate rain",
          65: "Heavy rain",
          66: "Light freezing rain",
          67: "Heavy freezing rain",
          71: "Slight snow fall",
          73: "Moderate snow fall",
          75: "Heavy snow fall",
          77: "Snow grains",
          80: "Slight rain showers",
          81: "Moderate rain showers",
          82: "Violent rain showers",
          85: "Slight snow showers",
          86: "Heavy snow showers",
          95: "Thunderstorm",
          96: "Thunderstorm with slight hail",
          99: "Thunderstorm with heavy hail"
        };
        return map[code] || "Unknown";
      }

      // Weather code to emoji
      function weatherIcon(code) {
        const map = {
          0: "‚òÄÔ∏è", 1: "üå§Ô∏è", 2: "‚õÖ", 3: "‚òÅÔ∏è",
          45: "üå´Ô∏è", 48: "üå´Ô∏è", 51: "üå¶Ô∏è", 53: "üå¶Ô∏è", 55: "üå¶Ô∏è",
          56: "üåßÔ∏è", 57: "üåßÔ∏è", 61: "üåßÔ∏è", 63: "üåßÔ∏è", 65: "üåßÔ∏è",
          66: "üåßÔ∏è", 67: "üåßÔ∏è", 71: "üå®Ô∏è", 73: "üå®Ô∏è", 75: "üå®Ô∏è",
          77: "üå®Ô∏è", 80: "üå¶Ô∏è", 81: "üå¶Ô∏è", 82: "üå¶Ô∏è",
          85: "üå®Ô∏è", 86: "üå®Ô∏è", 95: "‚õàÔ∏è", 96: "‚õàÔ∏è", 99: "‚õàÔ∏è"
        };
        return map[code] || "‚ùì";
      }

      // Crop suggestion logic based on weather
      function getCropSuggestion(avgTemp, avgRain) {
        if (avgRain > 40) {
          return "Recommended crops: Rice, Jute, Sugarcane (high rainfall crops)";
        } else if (avgTemp > 30) {
          return "Recommended crops: Maize, Cotton, Groundnut (heat-tolerant crops)";
        } else if (avgTemp > 20) {
          return "Recommended crops: Wheat, Barley, Pulses, Vegetables";
        } else {
          return "Recommended crops: Potato, Mustard, Peas (cool season crops)";
        }
      }

      // Enhanced irrigation advice logic
      function getIrrigationAdvice(avgRain) {
        if (avgRain > 40) {
          return `
            <strong>Rainfall is sufficient. Minimal irrigation required.</strong><br>
            <ul>
              <li>Monitor for waterlogging, especially in low-lying fields.</li>
              <li>Use raised beds for sensitive crops.</li>
              <li>Delay irrigation if heavy rain is forecasted.</li>
              <li>Check for fungal diseases due to excess moisture.</li>
            </ul>
          `;
        } else if (avgRain > 20) {
          return `
            <strong>Good rainfall, but supplement as needed.</strong><br>
            <ul>
              <li>Irrigate only if soil surface appears dry.</li>
              <li>Mulch to retain soil moisture and reduce evaporation.</li>
              <li>Check root zone moisture before irrigating.</li>
            </ul>
          `;
        } else if (avgRain > 10) {
          return `
            <strong>Moderate rainfall. Supplement with irrigation as needed.</strong><br>
            <ul>
              <li>Increase irrigation frequency for shallow-rooted crops.</li>
              <li>Use drip or sprinkler systems for efficient water use.</li>
              <li>Water early morning or late evening to reduce evaporation.</li>
            </ul>
          `;
        } else if (avgRain > 0) {
          return `
            <strong>Low rainfall. Regular irrigation is recommended.</strong><br>
            <ul>
              <li>Prioritize irrigation for fruiting and flowering crops.</li>
              <li>Apply water in small, frequent doses for sandy soils.</li>
              <li>Monitor for drought stress (wilting, leaf curl).</li>
            </ul>
          `;
        } else {
          return `
            <strong>No rainfall. Irrigation is essential.</strong><br>
            <ul>
              <li>Increase irrigation frequency for all crops.</li>
              <li>Use mulching and shade nets to conserve moisture.</li>
              <li>Check for signs of severe drought stress and irrigate immediately.</li>
            </ul>
          `;
        }
      }

      // Example: Fetch fertilizer advice from a public API (OpenAI or mock)
      // For demo, we'll use a static suggestion based on weather/crop, but you can replace with a real API call.
      function getFertilizerAdvice(avgTemp, avgRain) {
        if (avgRain > 40) {
          return "Due to high rainfall, use slow-release nitrogen fertilizers and avoid urea top-dressing before heavy rain. Apply potash to improve crop resilience.";
        } else if (avgTemp > 30) {
          return "High temperature: Use organic manure and split nitrogen application to reduce losses. Ensure adequate potassium for heat stress.";
        } else if (avgTemp > 20) {
          return "Balanced NPK (Nitrogen, Phosphorus, Potassium) fertilizers are recommended. Test soil before application for best results.";
        } else {
          return "Cool weather: Use phosphorus-rich fertilizers at sowing. Avoid excessive nitrogen to prevent delayed maturity.";
        }
      }

      // Fetch and display weather
      function showWeather(lat, lon) {
        const api = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=temperature_2m_max,temperature_2m_min,precipitation_sum,weathercode&timezone=auto&forecast_days=7`;
        fetch(api)
          .then(res => res.json())
          .then(data => {
            if (!data.daily) {
              document.getElementById('weather-forecast').textContent = "Weather data not available.";
              return;
            }
            const days = data.daily.time;
            const maxTemps = data.daily.temperature_2m_max;
            const minTemps = data.daily.temperature_2m_min;
            const rains = data.daily.precipitation_sum;
            const codes = data.daily.weathercode;

            let html = '<table class="table table-bordered"><thead><tr><th>Date</th><th>Weather</th><th>Max Temp (¬∞C)</th><th>Min Temp (¬∞C)</th><th>Rainfall (mm)</th></tr></thead><tbody>';
            let totalTemp = 0, totalRain = 0;
            for (let i = 0; i < days.length; i++) {
              html += `<tr>
                <td>${days[i]}</td>
                <td>${weatherIcon(codes[i])} ${weatherDescription(codes[i])}</td>
                <td>${maxTemps[i]}</td>
                <td>${minTemps[i]}</td>
                <td>${rains[i]}</td>
              </tr>`;
              totalTemp += (maxTemps[i] + minTemps[i]) / 2;
              totalRain += rains[i];
            }
            html += '</tbody></table>';
            document.getElementById('weather-forecast').innerHTML = html;

            // Crop suggestion and irrigation advice
            const avgTemp = totalTemp / days.length;
            const avgRain = totalRain / days.length;
            document.getElementById('crop-suggestion').innerHTML = getCropSuggestion(avgTemp, avgRain);
            document.getElementById('irrigation-advice').innerHTML = getIrrigationAdvice(avgRain);
            document.getElementById('fertilizer-advice').innerHTML = getFertilizerAdvice(avgTemp, avgRain);
          })
          .catch(() => {
            document.getElementById('weather-forecast').textContent = "Unable to fetch weather data.";
          });
      }

      // Get location and show weather
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          pos => showWeather(pos.coords.latitude, pos.coords.longitude),
          () => {
            document.getElementById('weather-forecast').textContent = "Unable to retrieve your location.";
            document.getElementById('crop-suggestion').textContent = "";
            document.getElementById('irrigation-advice').textContent = "";
            document.getElementById('fertilizer-advice').textContent = "";
          }
        );
      } else {
        document.getElementById('weather-forecast').textContent = "Geolocation not supported.";
      }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>